{"ast":null,"code":"import _asyncToGenerator from\"E:\\\\Ranji\\\\bharathbank\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";import _slicedToArray from\"E:\\\\Ranji\\\\bharathbank\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\slicedToArray.js\";import _regeneratorRuntime from\"E:\\\\Ranji\\\\bharathbank\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useState}from\"react\";import Card from\"./context\";import firebase from'firebase/compat/app';import'firebase/compat/auth';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var apiURL=\"http://localhost:8080\";export default function Login(){var _React$useState=React.useState(true),_React$useState2=_slicedToArray(_React$useState,2),show=_React$useState2[0],setShow=_React$useState2[1];var _React$useState3=React.useState(''),_React$useState4=_slicedToArray(_React$useState3,2),status=_React$useState4[0],setStatus=_React$useState4[1];return/*#__PURE__*/_jsx(Card,{bgcolor:\"secondary\",header:\"Login\",status:status,body:show?/*#__PURE__*/_jsx(LoginForm,{setShow:setShow,setStatus:setStatus}):/*#__PURE__*/_jsx(LoginMsg,{setShow:setShow,setStatus:setStatus})});}function LoginMsg(props){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h5\",{children:\"You Have Successfully logged in !!!\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn btn-light\",onClick:function onClick(){return props.setShow(true);},children:\"Authenticate again\"})]});}function LoginForm(props){var _React$useState5=React.useState(''),_React$useState6=_slicedToArray(_React$useState5,2),email=_React$useState6[0],setEmail=_React$useState6[1];var _React$useState7=React.useState(''),_React$useState8=_slicedToArray(_React$useState7,2),password=_React$useState8[0],setPassword=_React$useState8[1];function handle(){fetch(apiURL+\"/account/login/\".concat(email,\"/\").concat(password)).then(function(response){return response.text();}).then(function(text){try{var data=JSON.parse(text);props.setStatus('');props.setShow(false);localStorage.setItem('Name',data.name);localStorage.setItem('Email',data.email);}catch(err){props.setStatus(text);console.log('err:',text);}});var auth=firebase.auth();var promise=auth.signInWithEmailAndPassword(email,password);promise.catch(function(e){return console.log(e.message);});firebase.auth().onAuthStateChanged(function(firebaseUser){if(firebaseUser){firebaseUser.getIdToken().then(function(idToken){console.log('idToken:',idToken);_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response,text;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return fetch(apiURL+'/auth',{method:'GET',headers:{'Authorization':idToken}});case 2:response=_context.sent;_context.next=5;return response.text();case 5:text=_context.sent;case 6:case\"end\":return _context.stop();}}},_callee);}))();}).catch(function(e){return console.log('e:',e);});}else{console.log('User is not logged in');}});}return/*#__PURE__*/_jsxs(_Fragment,{children:[\"Email\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"input\",className:\"form-control\",placeholder:\"Enter email\",value:email,onChange:function onChange(e){return setEmail(e.currentTarget.value);}}),/*#__PURE__*/_jsx(\"br\",{}),\"Password\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",className:\"form-control\",placeholder:\"Enter password\",value:password,onChange:function onChange(e){return setPassword(e.currentTarget.value);}}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"button\",{id:\"login\",type:\"submit\",className:\"btn btn-light\",disabled:!email||!password,onClick:handle,children:\"Login\"})]});}","map":{"version":3,"sources":["E:/Ranji/bharathbank/client/src/components/login.js"],"names":["React","useState","Card","firebase","apiURL","Login","show","setShow","status","setStatus","LoginMsg","props","LoginForm","email","setEmail","password","setPassword","handle","fetch","then","response","text","data","JSON","parse","localStorage","setItem","name","err","console","log","auth","promise","signInWithEmailAndPassword","catch","e","message","onAuthStateChanged","firebaseUser","getIdToken","idToken","method","headers","currentTarget","value"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\r\nimport Card from \"./context\";\r\nimport firebase from 'firebase/compat/app';\r\nimport 'firebase/compat/auth';\r\n\r\nconst apiURL = `http://localhost:8080`;\r\n\r\nexport default function Login(){\r\n  const [show, setShow]     = React.useState(true);\r\n  const [status, setStatus] = React.useState('');  \r\n  return (\r\n    <Card\r\n      bgcolor=\"secondary\"\r\n      header=\"Login\"\r\n      status={status}\r\n      body={show ? \r\n        <LoginForm setShow={setShow} setStatus={setStatus}/> :\r\n        <LoginMsg setShow={setShow} setStatus={setStatus}/>}\r\n    />\r\n  ) \r\n}\r\n\r\nfunction LoginMsg(props){  \r\n  return(<>\r\n    <h5>You Have Successfully logged in !!!</h5>\r\n    <button type=\"submit\" \r\n      className=\"btn btn-light\" \r\n      onClick={() => props.setShow(true)}>\r\n        Authenticate again\r\n    </button>\r\n  </>);\r\n}\r\n\r\nfunction LoginForm(props){\r\n  const [email, setEmail]       = React.useState('');\r\n  const [password, setPassword] = React.useState('');\r\n  \r\n  \r\n  function handle(){\r\n    fetch(apiURL+ `/account/login/${email}/${password}`)\r\n    .then(response => response.text())\r\n    .then(text => {\r\n        try {\r\n            const data = JSON.parse(text);\r\n            props.setStatus('');\r\n            props.setShow(false);\r\n                        \r\n            localStorage.setItem('Name',data.name);  \r\n            localStorage.setItem('Email',data.email);            \r\n        } catch(err) {\r\n            props.setStatus(text)\r\n            console.log('err:', text);\r\n        }\r\n    }); \r\n      const auth  = firebase.auth();  \r\n      \r\n      const promise = auth.signInWithEmailAndPassword(email, password);\r\n      promise.catch(e => console.log(e.message));\r\n      firebase.auth().onAuthStateChanged(firebaseUser => {\r\n        if(firebaseUser){\r\n          firebaseUser.getIdToken().then(idToken => {\r\n            console.log('idToken:', idToken);\r\n            (async () => {\r\n              let response = await fetch(apiURL+'/auth', {\r\n                  method: 'GET',\r\n                  headers: {\r\n                      'Authorization': idToken\r\n                  }\r\n              });\r\n              let text = await response.text();\r\n              // routeMsg.innerHTML = text;\r\n          })();\r\n         }).catch(e => console.log('e:',e));\r\n                \r\n        }\r\n        else{\r\n            console.log('User is not logged in');          \r\n        }\r\n    });\r\n    \r\n  \r\n  }\r\n  return (<>\r\n    Email<br/>\r\n    <input type=\"input\" \r\n      className=\"form-control\" \r\n      placeholder=\"Enter email\" \r\n      value={email} \r\n      onChange={e => setEmail(e.currentTarget.value)}/><br/>\r\n\r\n    Password<br/>\r\n    <input type=\"password\" \r\n      className=\"form-control\" \r\n      placeholder=\"Enter password\" \r\n      value={password} \r\n      onChange={e => setPassword(e.currentTarget.value)}/><br/>\r\n    <button id=\"login\" type=\"submit\" className=\"btn btn-light\" disabled={!email || !password}onClick={handle}>Login</button>  \r\n  </>);\r\n}"]},"metadata":{},"sourceType":"module"}